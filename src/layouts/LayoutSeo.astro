---
/**
 * Definición de las propiedades esperadas para este layout.
 */
import { ClientRouter } from 'astro:transitions';
import '@styles/global.css';
import Seo from '@components/common/Seo.astro';
import Footer from '@components/sections/Footer.astro';
import Navbar from '@components/sections/Navbar';
import Modal from '@components/sections/Modal.astro';

interface Props {
    tituloPagina: string;
    description?: string;
    slug?: string;
    image?: string;
    type?: string;
    seoJsonLd: object | null;
}
const {
    tituloPagina,
    description,
    slug,
    image,
    type,
    seoJsonLd: jsonLd,
} = Astro.props;

const currentUrl = Astro.url.pathname;
---

<html lang="en">
    <head>
        <ClientRouter />
        <Seo
            titleWeb={tituloPagina}
            descriptionWeb={description}
            slug={slug}
            imageWeb={image}
            typeWeb={type}
            jsonLd={jsonLd}
        />
        <meta
            name="google-site-verification"
            content="Ev2TdFXtbkht-Jxmbq-7wNtUnlUTWrJgmiPypLEEv1A"
        />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
            rel="stylesheet"
        />
        <!-- Theme initialization script to prevent flash -->
        <script is:inline>
            (function () {
                function applyTheme(isDark) {
                    const htmlElement = document.documentElement;
                    if (isDark) {
                        htmlElement.classList.add('dark');
                        htmlElement.setAttribute('data-theme', 'dark');
                    } else {
                        htmlElement.classList.remove('dark');
                        htmlElement.setAttribute('data-theme', 'light');
                    }
                }

                function initTheme() {
                    const savedTheme = localStorage.getItem('theme');
                    let isDark;

                    if (savedTheme) {
                        isDark = savedTheme === 'dark';
                    } else {
                        isDark = window.matchMedia(
                            '(prefers-color-scheme: dark)',
                        ).matches;
                    }

                    applyTheme(isDark);
                    return isDark;
                }

                // Initialize immediately
                initTheme();

                // Re-initialize on Astro navigation
                document.addEventListener('astro:page-load', initTheme);
                document.addEventListener('astro:after-swap', initTheme);
            })();
        </script>
    </head>

    <body
        class="overflow-y-scroll"
        style="background-color: var(--color-bg); color: var(--color-text);"
    >
        <Navbar client:only="true" currentUrl={currentUrl} transition:persist />
        <div
            class="mx-auto max-w-2xl px-4 py-16 sm:px-6 sm:py-24 lg:max-w-7xl lg:px-8"
            style="background-color: var(--color-bg);"
        >
            <Modal />
            <!-- Secciones animadas (revisar si `animate-fade-down` pertenece a una librería como Tailwind) -->
            <slot name="FondoHero" class="animate-fade-down" />
            <slot name="Hero" class="animate-fade-down" />

            <!-- Sección de cursos destacados -->
            <slot name="CursosDestacados" />

            <!-- Espacio para contenido adicional -->
            <slot />
        </div>
        <Footer />
    </body>
</html>

<script>
    // Evento de prueba para detectar navegación (puede eliminarse en producción)
    window.addEventListener('navigate', () => {});
</script>
